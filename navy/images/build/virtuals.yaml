---

requests:
  - endpoint: /build
    method: POST
    loop:
      - id: build.virtual.base
        virtual: true
        query:
          nocache: false
          buildargs:
            HTTP_PROXY: ${http_proxy:-${HTTP_PROXY:-}}
            HTTPS_PROXY: ${https_proxy:-${HTTPS_PROXY:-}}
      - id: build.virtual.entrypoint
        virtual: true
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: ${CHECK_ENTRYPOINT_PATH}
            CHECK_ENTRYPOINTD_PATH: ${CHECK_ENTRYPOINTD_PATH}
            ENTRYPOINT_PATH: ${ENTRYPOINT_PATH}
            ENTRYPOINTD_PATH: ${ENTRYPOINTD_PATH}
        context: ${LAYERS_PATH}/${ENTRYPOINT_ID}
        extends:
          - build.virtual.base
      - id: build.virtual.alpine.entrypoint
        virtual: true
        query:
          buildargs:
            ENTRYPOINT_LAYER_IMG: ${ENTRYPOINT_LAYER_IMG}
        depends_on:
          - build.alpine.entrypoint
        extends:
          - build.virtual.base
      - id: build.virtual.bash
        virtual: true
        query:
          buildargs:
            BASH_LAYER_IMG: ${BASH_LAYER_IMG}
        depends_on:
          - build.bash
        extends:
          - build.virtual.base
      - id: build.virtual.workspaces
        virtual: true
        query:
          buildargs:
            WORKSPACES_LAYER_IMG: ${WORKSPACES_LAYER_IMG}
        depends_on:
          - build.workspaces
        extends:
          - build.virtual.base
      - id: build.virtual.sshd
        virtual: true
        query:
          buildargs:
            SSHD_LAYER_IMG: ${SSHD_LAYER_IMG}
        depends_on:
          - build.sshd
        extends:
          - build.virtual.base
      - id: build.virtual.git
        virtual: true
        query:
          buildargs:
            GIT_LAYER_IMG: ${GIT_LAYER_IMG}
        depends_on:
          - build.git
        extends:
          - build.virtual.base
      - id: build.virtual.nginx
        virtual: true
        query:
          buildargs:
            NGINX_LAYER_IMG: ${NGINX_LAYER_IMG}
        depends_on:
          - build.nginx
        extends:
          - build.virtual.base
      - id: build.virtual.relay
        virtual: true
        query:
          buildargs:
            ENTRYPOINTD_PATH: ${ENTRYPOINTD_PATH}
            SOCAT_LAYER_IMG: ${SOCAT_LAYER_IMG}
            TMP_XSERVER_SOCKETS_PATH: ${TMP_XSERVER_SOCKETS_PATH}
            XSERVER_IP: ${XSERVER_IP}
            XSERVER_PORT: ${XSERVER_PORT}
        context: ${CWD_PATH}/${RELAY_ID}
        depends_on:
          - build.socat
        extends:
          - build.virtual.base

...
