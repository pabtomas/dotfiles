---

run:
  - endpoint: /build
    method: POST
    loop:
      - id: images.build.alpine.entrypoint
        query:
          buildargs:
            BASE_IMG: ${OS_LOCAL_IMG}:{{ datasource "datasources/all.yaml".os.tag }}
          t: ${ENTRYPOINT_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        depends_on:
          - images.tag.alpine
        extends:
          - images.build.virtual.entrypoint
      - id: images.build.bash.entrypoint
        query:
          buildargs:
            BASE_IMG: ${BASH_LOCAL_IMG}:{{ (datasource "datasources/bash.yaml").tag }}
          t: ${BASH_ENTRYPOINT_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        depends_on:
          - images.tag.bash
        extends:
          - images.build.virtual.entrypoint
      - id: images.build.gpu
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${GPU_ID}.sh
          t: ${GPU_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${GPU_ID}
        extends:
          - images.build.virtual.alpine.entrypoint
      - id: images.build.linguist
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${LINGUIST_ID}.sh
          t: ${LINGUIST_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${LINGUIST_ID}
        extends:
          - images.build.virtual.alpine.entrypoint
      - id: images.build.nginx
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${NGINX_ID}.sh
            ENTRYPOINTD_PATH: {{ (datasource "datasources/entrypoint.yaml").path.entrypoint.d }}
            ETC_NGINX_CONFD_PATH: {{ (datasource "datasources/nginx.yaml").path.confd }}
            ETC_NGINX_HTTPD_PATH: {{ (datasource "datasources/nginx.yaml").path.httpd }}
            VAR_LOG_NGINX_PATH: {{ (datasource "datasources/nginx.yaml").path.var.log }}
          t: ${NGINX_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${NGINX_ID}
        extends:
          - images.build.virtual.alpine.entrypoint
      - id: images.build.socat
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${SOCAT_ID}.sh
          t: ${SOCAT_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${SOCAT_ID}
        extends:
          - images.build.virtual.alpine.entrypoint
      - id: images.build.spectrwm
        query:
          buildargs:
            BIN_PATH: {{ (datasource "datasources/all.yaml").path.bin }}
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${SPECTRWM_ID}.sh
          t: ${SPECTRWM_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${SPECTRWM_ID}
        extends:
          - images.build.virtual.alpine.entrypoint
      - id: images.build.http
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${HTTP_ID}.sh
            ETC_NGINX_HTTPD_PATH: {{ (datasource "datasources/nginx.yaml").path.httpd }}
            ETC_NGINX_PATH: {{ (datasource "datasources/nginx.yaml").path.etc }}
            LINUXSERVER_PROXY_LOCAL_IMG: ${LINUXSERVER_PROXY_LOCAL_IMG}:{{ (datasource "datasources/socket-proxy.yaml").linuxserver.tag }}
          t: ${HTTP_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${HTTP_ID}
        depends_on:
          - images.tag.proxy
        extends:
          - images.build.virtual.nginx
      - id: images.build.bash
        query:
          buildargs:
            BASH_ALIASES_PATH: {{ (datasource "datasources/bash.yaml").path.aliases }}
            BASH_COMPLETION_PATH: {{ (datasource "datasources/bash.yaml").path.completion }}
            BASH_ENTRYPOINT_LAYER_IMG: ${BASH_ENTRYPOINT_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
            BASH_LOCAL_IMG: ${BASH_LOCAL_IMG}:{{ (datasource "datasources/bash.yaml").tag }}
            BASH_THEME_PATH: {{ (datasource "datasources/bash.yaml").path.theme }}
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${BASH_ID}.sh
            ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.entrypoint.sh }}
          t: ${BASH_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${BASH_ID}
        depends_on:
          - images.build.bash.entrypoint
        extends:
          - images.build.virtual.base
      - id: images.build.tmux
        query:
          buildargs:
            BASH_COMPLETION_PATH: {{ (datasource "datasources/bash.yaml").path.completion }}
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${TMUX_ID}.sh
            TMUX_COMPLETION_URL: ${TMUX_COMPLETION_URL}
            TPM_PATH: {{ (datasource "datasources/tmux.yaml").path.tpm }}
            TPM_URL: ${TPM_URL}
          t: ${TMUX_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${TMUX_ID}
        extends:
          - images.build.virtual.bash
      - id: images.build.sshd
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${SSHD_ID}.sh
            ENTRYPOINTD_PATH: {{ (datasource "datasources/entrypoint.yaml").path.entrypoint.d }}
            SSH_PORT: ${SSH_PORT}
          t: ${SSHD_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${SSHD_ID}
        extends:
          - images.build.virtual.bash
      - id: images.build.docker
        query:
          buildargs:
            _DOCKER_LOCAL_IMG: ${_DOCKER_LOCAL_IMG}:{{ (datasource "datasources/docker.yaml").tag }}
            _DOCKER_PLUGINS_PATH: {{ (datasource "datasources/docker.yaml").path.plugins }}
            BIN_PATH: {{ (datasource "datasources/all.yaml").path.bin }}
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${_DOCKER_ID}.sh
            DOCKLE_DOWNLOAD_URL: ${DOCKLE_DOWNLOAD_URL}
            DOCKLE_TAG: {{ datasource "datasources/dockle.yaml".tag }}
            ENTRYPOINTD_PATH: {{ (datasource "datasources/entrypoint.yaml").path.entrypoint.d }}
            HTTP_DOCKER_TARGET: ${HTTP_DOCKER_TARGET}
            NET: {{ (datasource "datasources/networks.yaml").jump_area.name }}
            REGBOT_URL: ${REGBOT_URL}
            REGCTL_URL: ${REGCTL_URL}
            REGISTRY_TARGET: ${REGISTRY_TARGET}
            REGSYNC_URL: ${REGSYNC_URL}
            TCP_BUILDKIT_TARGET: ${TCP_BUILDKIT_TARGET}
            TCP_DOCKER_TARGET: ${TCP_DOCKER_TARGET}
            XEPHYR_DISPLAY: ${XEPHYR_DISPLAY}
          t: ${_DOCKER_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${DOCKER_ID}
        depends_on:
          - images.tag.docker
        extends:
          - images.build.virtual.sshd
      - id: images.build.man
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${MAN_ID}.sh
          t: ${MAN_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${MAN_ID}
        extends:
          - images.build.virtual.sshd
      - id: images.build.pass
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${PASS_ID}.sh
          t: ${PASS_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${PASS_ID}
        extends:
          - images.build.virtual.sshd
      - id: images.build.workspaces
        query:
          buildargs:
            OPT_SCRIPTS_PATH: {{ (datasource "datasources/all.yaml").path.opt.scripts }}
            OWNER_URL: ${OWNER_URL}
            SPACEPORN_ID: ${SPACEPORN_ID}
            SSHD_LAYER_IMG: ${SSHD_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
            WORKSPACES_PATH: {{ (datasource "datasources/workspaces.yaml").path.root }}
          t: ${WORKSPACES_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${WORKSPACES_ID}
        extends:
          - images.build.virtual.sshd
      - id: images.build.vim
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${VIM_ID}.sh
            NERDTREE_URL: ${NERDTREE_URL}
            POLYGLOT_URL: ${POLYGLOT_URL}
            RAINBOW_URL: ${RAINBOW_URL}
            UNDOTREE_URL: ${UNDOTREE_URL}
          t: ${VIM_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${VIM_ID}
        extends:
          - images.build.virtual.workspaces
      - id: images.build.explorer
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${EXPLORER_ID}.sh
          t: ${EXPLORER_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${EXPLORER_ID}
        extends:
          - images.build.virtual.workspaces
      - id: images.build.git
        query:
          buildargs:
            BASH_COMPLETION_PATH: {{ (datasource "datasources/bash.yaml").path.completion }}
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${GIT_ID}.sh
            EXPLORER_LAYER_IMG: ${EXPLORER_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
            TIG_COMPLETION_URL: ${TIG_COMPLETION_URL}
          t: ${GIT_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${GIT_ID}
        depends_on:
          - images.build.explorer
        extends:
          - images.build.virtual.base
      - id: images.build.shell
        query:
          buildargs:
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${SHELL_ID}.sh
          t: ${SHELL_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${SHELL_ID}
        extends:
          - images.build.virtual.git
      - id: images.build.zig
        query:
          buildargs:
            BASH_COMPLETION_PATH: {{ (datasource "datasources/bash.yaml").path.completion }}
            BIN_PATH: {{ (datasource "datasources/all.yaml").path.bin }}
            CHECK_ENTRYPOINT_PATH: {{ (datasource "datasources/entrypoint.yaml").path.check.d }}/99${ZIG_ID}.sh
            ZIG_BUILDS_URL: ${ZIG_BUILDS_URL}
            ZIG_COMPLETION_URL: ${ZIG_COMPLETION_URL}
            ZIG_TAG: {{ datasource "datasources/zig.yaml".tag }}
          t: ${ZIG_LAYER_IMG}:{{ (datasource "datasources/all.yaml").owner.tag }}
        context: {{ (datasource "datasources/all.yaml").path.dockerfiles }}/${ZIG_ID}
        extends:
          - images.build.virtual.git

...
