#! /usr/bin/env dash

main ()
{
  set -eux

  # catch DOCKER_HOST var

  # catch env vars:
  #   * NAVY_CACHE_PATH

  # parse options:
  #   * --no-cache
  #   * --file
  #   * --help
  #   * --verbose
  #   * --tree-deps

  # define default values

  # if cache not found:
  #   - gomplate to resolve GO templates with datasources:
  #       Use this CLI to expand templates into values but not in keys (improve
  #       it to works (recursively) with dictionnaries):
  #       $ yq '. | to_entries[] | "{{ print \"" + .key + "\" }}:" + .value' bases.yaml | gomplate -d bases.yaml=bases.yaml
  #   - resolve 'anchors' keywords
  #       - explode anchors and aliases
  #   - check circular dependencies between includes
  #   - resolve 'includes' keywords
  #   - change loop tasks and tasks[].loop into dictionnaries to:
  #     - resolve 'extends' (replace them with anchors and aliases then use yq explode)
  #   - yq script to generate sh script.
  #   - generate cache: sha256sum <(find . -type -f -exec sha256sum {} \; | sort  | cut -d' ' -f1)
  # fi
  # depending of parsed options:
  # - run sh script with: seq 1 10 | xargs --max-args 1 --max-procs "$(( $(nproc) + 1 ))" ./script
  # - or use git to see dependencies as a tree
}

main "${@}"
