---

run:
  - endpoint: /networks
    method: GET
    register:
      as:
        id: networks.json
        scope: networks.create.*
  - if: '{{ $net := coll.Slice }}{{ range (datasource "networks.json") }}{{ $net = $net | append .Name }}{{ end }}
      {{ or (not (has $net (datasource "datasources/networks.yaml").docker_network))
            (not (has $net (datasource "datasources/networks.yaml").proxified_docker_socket_network))
            (not (has $net (datasource "datasources/networks.yaml").proxified_xserver_socket_network))
            (not (has $net (datasource "datasources/networks.yaml").jum_area_network)) }}'
    endpoint: /networks/create
    method: POST
    loop:
      - id: networks.create.virtual
        virtual: true
        query:
          Driver: bridge
          IPAM:
            Driver: default
          Labels:
            navy: true
        depends_on:
          - networks.json
      - id: networks.create.{{ (datasource "datasources/networks.yaml").docker_utils_network }}
        query:
          Name: {{ (datasource "datasources/networks.yaml").docker_utils_network }}
          IPAM:
            Config:
              - Subnet: {{ (datasource "datasources/networks.yaml").docker_utils_subnet }}
                IPRange: {{ (datasource "datasources/networks.yaml").docker_utils_subnet }}
                Gateway: {{ (datasource "datasources/networks.yaml").docker_utils_gateway_ip }}
        extends:
          - networks.create.virtual
      - id: networks.create.{{ (datasource "datasources/networks.yaml").jump_area_network }}
        query:
          Name: {{ (datasource "datasources/networks.yaml").jump_area_network }}
          IPAM:
            Config:
              - Subnet: {{ (datasource "datasources/networks.yaml").jump_area_subnet }}
                IPRange: {{ (datasource "datasources/networks.yaml").jump_area_subnet }}
                Gateway: {{ (datasource "datasources/networks.yaml").jump_area_gateway_ip }}
        extends:
          - networks.create.virtual
      - id: networks.create.{{ (datasource "datasources/networks.yaml").proxified_docker_socket_network }}
        query:
          Name: {{ (datasource "datasources/networks.yaml").proxified_docker_socket_network }}
          IPAM:
            Config:
              - Subnet: {{ (datasource "datasources/networks.yaml").proxified_docker_socket_subnet }}
                IPRange: {{ (datasource "datasources/networks.yaml").proxified_docker_socket_subnet }}
                Gateway: {{ (datasource "datasources/networks.yaml").proxified_docker_socket_gateway_ip }}
        extends:
          - networks.create.virtual
      - id: networks.create.{{ (datasource "datasources/networks.yaml").proxified_xserver_socket_network }}
        query:
          Name: {{ (datasource "datasources/networks.yaml").proxified_xserver_socket_network }}
          IPAM:
            Config:
              - Subnet: {{ (datasource "datasources/networks.yaml").proxified_xserver_socket_subnet }}
                IPRange: {{ (datasource "datasources/networks.yaml").proxified_xserver_socket_subnet }}
                Gateway: {{ (datasource "datasources/networks.yaml").proxified_xserver_socket_gateway_ip }}
        extends:
          - networks.create.virtual

...
