name: ${SPACEPORN_ID}
services:
  ${SPACEPORN_SERVICE}:
    build:
      context: ${RUNNERS_PATH}/${SPACEPORN_ID}
      dockerfile: Dockerfile
    container_name: ${SPACEPORN_RUNNER_HOST}
    deploy:
      resources:
        reservations:
          devices:
            - capabilities:
                - gpu
              count: -1
    image: ${SPACEPORN_RUNNER_IMG}
    networks:
      ${SPACEPORN_ID}_net: null
      ${PROXIFIED_XSERVER_SOCKET_NET}: null
    volumes:
      - type: volume
        source: ${SPACEPORN_VOLUME}
        target: ${SPACEPORN_PATH}
        read_only: true
        volume: {}
networks:
  ${SPACEPORN_ID}_net:
    name: ${SPACEPORN_ID}_net
  ${PROXIFIED_XSERVER_SOCKET_NET}:
    name: ${PROXIFIED_XSERVER_SOCKET_NET}
    external: true
volumes:
  ${SPACEPORN_VOLUME}:
    name: ${SPACEPORN_VOLUME}
    external: true
