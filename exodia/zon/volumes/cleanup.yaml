---

rules:
  - id: '{{ $rules.down }}'
    run:
      - endpoint: /volumes
        method: GET
        register:
          id: down.volumes.json
          query:
            filters: '{"label":{"exodia":{{ $project.id }}}}'
          errexit: false
          as: registerdownvolumes
      - endpoint: /volumes/{name}
        method: DELETE
        from:
          id: remove.from.down.volumes.json
          filter: '{{ $array := "" }}{{ range $registerdownvolumes }}{{ $array = print $array "{\"path\":{\"name\":\"" .Name "\"},\"query\":{\"force\":true}}," }}{{ end }}{{ print "[" $array "]" | data.YAMLArray }}'
          errexit: false
          depends_on:
            - down.volumes.json

...
